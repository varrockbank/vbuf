<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>buffee - Conway's Game of Life</title>
  <script src="../buffee.js"></script>
  <link rel="stylesheet" href="../reset.css">
  <link rel="stylesheet" href="../style.css">
  <link rel="stylesheet" href="../themes/chelsey.css">
</head>
<body class="sample">
  <nav id="nav"></nav>
  <script>
    fetch('../navigation.html')
      .then(r => r.text())
      .then(html => document.getElementById('nav').innerHTML = html);
  </script>
  <p><a href="../index.html">home</a> / <a href="index.html">samples</a> / Conway's Game of Life</p>

  <h1>Conway's Game of Life</h1>
  <p>Interactive cellular automaton demonstrating pattern evolution. Includes preset patterns like gliders and oscillators.</p>

  <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 10px; flex-wrap: wrap;">
    <button id="play-pause-btn">Play</button>
    <button id="reset-btn">Reset</button>
    <div style="display: flex; align-items: center; gap: 8px;">
      <label for="speed-slider">Speed:</label>
      <input type="range" id="speed-slider" min="50" max="1000" value="200" style="width: 120px;">
      <span id="speed-value">200ms</span>
    </div>
  </div>

  <blockquote class="wb no-select buffee-themepack1 chelsey" tabindex="0" id="editor" style="border: 1px solid #ccc; width: 100%;">
    <textarea class="wb-clipboard-bridge"></textarea>
    <div class="wb-content">
      <div class="wb-gutter"></div>
      <div class="wb-lines" style="flex: 1;"><div class="wb-layer-text"></div><div class="wb-layer-elements"></div><div class="wb-cursor"></div></div>
    </div>
    <div class="wb-status" style="display: flex; justify-content: space-between; background: #f0f0f0;">
      <div><span class="wb-linecount"></span></div>
      <div style="display: flex;">
        <span class="wb-coordinate"></span>|
        
        <span class="wb-indentation"></span>
      </div>
    </div>
  </blockquote>

  <script>
    const editorEl = document.getElementById('editor');
    const editor = new Buffee(editorEl, {
      viewportRows: 30,
      showStatusLine: false,
      showGutter: false
    });

    const CONWAY_COLS = 80;
    const CONWAY_ROWS = 30;
    let conwayGrid = [];
    let conwayPlaying = false;
    let conwayInterval = null;
    let conwayDelay = 200;

    function initConwayGrid() {
      conwayGrid = [];
      for (let row = 0; row < CONWAY_ROWS; row++) {
        conwayGrid[row] = [];
        for (let col = 0; col < CONWAY_COLS; col++) {
          conwayGrid[row][col] = Math.random() < 0.25 ? 1 : 0;
        }
      }

      // Add a glider in the top-left
      if (CONWAY_ROWS > 5 && CONWAY_COLS > 5) {
        conwayGrid[1][2] = 1;
        conwayGrid[2][3] = 1;
        conwayGrid[3][1] = 1;
        conwayGrid[3][2] = 1;
        conwayGrid[3][3] = 1;
      }
    }

    function countNeighbors(row, col) {
      let count = 0;
      for (let dr = -1; dr <= 1; dr++) {
        for (let dc = -1; dc <= 1; dc++) {
          if (dr === 0 && dc === 0) continue;
          const newRow = (row + dr + CONWAY_ROWS) % CONWAY_ROWS;
          const newCol = (col + dc + CONWAY_COLS) % CONWAY_COLS;
          count += conwayGrid[newRow][newCol];
        }
      }
      return count;
    }

    function updateConway() {
      const newGrid = [];

      for (let row = 0; row < CONWAY_ROWS; row++) {
        newGrid[row] = [];
        for (let col = 0; col < CONWAY_COLS; col++) {
          const neighbors = countNeighbors(row, col);
          const alive = conwayGrid[row][col];

          if (alive) {
            newGrid[row][col] = (neighbors === 2 || neighbors === 3) ? 1 : 0;
          } else {
            newGrid[row][col] = (neighbors === 3) ? 1 : 0;
          }
        }
      }

      conwayGrid = newGrid;
      renderConway();
    }

    function renderConway() {
      const lines = [];
      for (let row = 0; row < CONWAY_ROWS; row++) {
        let line = '';
        for (let col = 0; col < CONWAY_COLS; col++) {
          line += conwayGrid[row][col] ? '#' : '.';
        }
        lines.push(line);
      }
      editor.Model.text = lines.join('\n');
    }

    function playConway() {
      if (conwayPlaying) return;
      conwayPlaying = true;
      document.getElementById('play-pause-btn').textContent = 'Pause';
      conwayInterval = setInterval(updateConway, conwayDelay);
    }

    function pauseConway() {
      conwayPlaying = false;
      document.getElementById('play-pause-btn').textContent = 'Play';
      if (conwayInterval) {
        clearInterval(conwayInterval);
        conwayInterval = null;
      }
    }

    function resetConway() {
      pauseConway();
      initConwayGrid();
      renderConway();
    }

    document.getElementById('play-pause-btn').addEventListener('click', () => {
      if (conwayPlaying) {
        pauseConway();
      } else {
        playConway();
      }
    });

    document.getElementById('reset-btn').addEventListener('click', resetConway);

    document.getElementById('speed-slider').addEventListener('input', (e) => {
      conwayDelay = parseInt(e.target.value);
      document.getElementById('speed-value').textContent = conwayDelay + 'ms';
      if (conwayPlaying) {
        pauseConway();
        playConway();
      }
    });

    // Initialize
    initConwayGrid();
    renderConway();
  </script>
</body>
</html>
