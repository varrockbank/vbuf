<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>vbuf - Elementals (Layer-based UI)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="../vbuf.js"></script>
  <script src="../extensions/elementals.js"></script>
  <style>
    .wb {
      background-color: #282C34;
      color: #B2B2B2;
      position: relative;
      outline: none;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
    }
    .no-select { user-select: none; }
    .wb-clipboard-bridge {
      position: fixed; left: 0; top: 1px;
      width: 0; height: 1px; opacity: 0; pointer-events: none;
    }
    .wb .wb-lines pre::before { content: "\200B"; }
    .wb .wb-lines pre { margin: 0; overflow: hidden; }
    .wb .wb-selection {
      background-color: #EDAD10;
      position: absolute;
      mix-blend-mode: difference;
    }
    .wb .wb-cursor {
      background-color: #FF6B6B;
    }
    .wb .wb-status span { padding-right: 4px; }

    /* Elementals styling */
    .wb-elemental-button {
      background-color: #3a3f4b;
      color: #eaeaea;
      padding: 2px 8px;
      border: 1px solid #555;
      border-radius: 3px;
    }
    .wb-elemental-button:hover {
      background-color: #4a4f5b;
      border-color: #777;
    }
    .wb-elemental-focused .wb-elemental-button {
      outline: 2px solid #EDAD10;
      outline-offset: 1px;
    }
    .wb-elemental-label {
      color: #888;
    }
    .wb-elemental-input {
      background-color: #1a1d23 !important;
      border-color: #555 !important;
    }
    .wb-elemental-input:focus {
      outline: 2px solid #EDAD10;
      outline-offset: -1px;
    }
    .wb-elemental-focused .wb-elemental-input {
      border-color: #EDAD10 !important;
    }
  </style>
</head>
<body class="bg-neutral-900 p-5 font-sans">
  <h1 class="text-white text-lg mb-2">Elementals - Layer-based UI</h1>
  <p class="text-neutral-400 text-sm mb-2">
    Unlike tui-legacy which manipulates text content, Elementals creates actual DOM elements in a layer above the text.
  </p>
  <p class="text-neutral-400 text-sm mb-6">
    Press <kbd class="bg-neutral-700 border border-neutral-500 rounded px-1.5 py-0.5 font-mono text-white text-xs">Tab</kbd> to navigate,
    <kbd class="bg-neutral-700 border border-neutral-500 rounded px-1.5 py-0.5 font-mono text-white text-xs">Enter</kbd> to activate
  </p>

  <h2 class="text-neutral-300 text-sm mt-8 mb-2">Buttons</h2>
  <p class="text-neutral-500 text-xs">JS:</p>
  <p class="text-neutral-500 text-xs"><code class="text-green-400">VbufElementals(editor)</code></p>
  <p class="text-neutral-500 text-xs mb-2"><code class="text-green-400">Elementals.addButton({ row: 1, col: 5, label: 'Click Me' })</code></p>
  <blockquote class="wb no-select border border-neutral-700 w-[600px] mb-4" tabindex="0" id="buttons-demo">
    <textarea class="wb-clipboard-bridge" aria-hidden="true"></textarea>
    <div class="flex">
      <div class="wb-gutter"></div>
      <div class="wb-lines flex-1 overflow-hidden"></div>
    </div>
    <div class="wb-status flex justify-between p-1.5" style="background: #212026; color: #B2B2B2;">
      <div class="wb-status-left"><span class="wb-linecount"></span></div>
      <div class="wb-status-right flex">
        <span class="wb-coordinate"></span>
        <span>|</span>
        <span class="wb-indentation"></span>
      </div>
    </div>
  </blockquote>

  <h2 class="text-neutral-300 text-sm mt-8 mb-2">Input Fields</h2>
  <p class="text-neutral-500 text-xs">JS:</p>
  <p class="text-neutral-500 text-xs mb-2"><code class="text-green-400">Elementals.addInput({ row: 2, col: 10, width: 20, placeholder: 'Type here...' })</code></p>
  <blockquote class="wb no-select border border-neutral-700 w-[600px] mb-4" tabindex="0" id="inputs-demo">
    <textarea class="wb-clipboard-bridge" aria-hidden="true"></textarea>
    <div class="flex">
      <div class="wb-gutter"></div>
      <div class="wb-lines flex-1 overflow-hidden"></div>
    </div>
    <div class="wb-status flex justify-between p-1.5" style="background: #212026; color: #B2B2B2;">
      <div class="wb-status-left"><span class="wb-linecount"></span></div>
      <div class="wb-status-right flex">
        <span class="wb-coordinate"></span>
        <span>|</span>
        <span class="wb-indentation"></span>
      </div>
    </div>
  </blockquote>

  <h2 class="text-neutral-300 text-sm mt-8 mb-2">Mixed Elements</h2>
  <p class="text-neutral-500 text-xs mb-2">Combining labels, inputs, and buttons</p>
  <blockquote class="wb no-select border border-neutral-700 w-[600px] mb-4" tabindex="0" id="mixed-demo">
    <textarea class="wb-clipboard-bridge" aria-hidden="true"></textarea>
    <div class="flex">
      <div class="wb-gutter"></div>
      <div class="wb-lines flex-1 overflow-hidden"></div>
    </div>
    <div class="wb-status flex justify-between p-1.5" style="background: #212026; color: #B2B2B2;">
      <div class="wb-status-left"><span class="wb-linecount"></span></div>
      <div class="wb-status-right flex">
        <span class="wb-coordinate"></span>
        <span>|</span>
        <span class="wb-indentation"></span>
      </div>
    </div>
  </blockquote>

  <div id="output" class="font-mono text-green-400 mt-3 p-3 bg-neutral-950 border border-neutral-700 min-h-[24px] w-[600px]">
    Interact with the elements above
  </div>

  <script>
    const output = document.getElementById('output');

    // Buttons demo
    const buttonsEl = document.getElementById('buttons-demo');
    const buttonsEditor = new Vbuf(buttonsEl, {
      initialViewportSize: 5,
      showGutter: false,
      colorPrimary: "#B2B2B2",
      colorSecondary: "#212026"
    });
    VbufElementals(buttonsEditor);
    buttonsEditor.Model.text = '\n\n\n\n';
    buttonsEditor.Elementals.addButton({
      row: 1, col: 2,
      label: 'Save',
      onActivate: () => { output.textContent = 'Save clicked!'; }
    });
    buttonsEditor.Elementals.addButton({
      row: 1, col: 12,
      label: 'Load',
      onActivate: () => { output.textContent = 'Load clicked!'; }
    });
    buttonsEditor.Elementals.addButton({
      row: 1, col: 22,
      label: 'Cancel',
      onActivate: () => { output.textContent = 'Cancel clicked!'; }
    });
    buttonsEditor.Elementals.addButton({
      row: 3, col: 2,
      label: 'Delete',
      onActivate: () => { output.textContent = 'Delete clicked!'; }
    });
    buttonsEditor.Elementals.enabled = true;
    buttonsEl.addEventListener('keydown', (e) => {
      if (e.key === 'Tab') {
        e.preventDefault();
        buttonsEditor.Elementals.nextElement();
      } else if (e.key === 'Enter') {
        e.preventDefault();
        buttonsEditor.Elementals.activateFocused();
      }
    });

    // Inputs demo
    const inputsEl = document.getElementById('inputs-demo');
    const inputsEditor = new Vbuf(inputsEl, {
      initialViewportSize: 5,
      showGutter: false,
      colorPrimary: "#B2B2B2",
      colorSecondary: "#212026"
    });
    VbufElementals(inputsEditor);
    inputsEditor.Model.text = '\n\n\n\n';
    inputsEditor.Elementals.addLabel({ row: 1, col: 2, text: 'Name:' });
    inputsEditor.Elementals.addInput({
      row: 1, col: 9,
      width: 20,
      placeholder: 'Enter name',
      onSubmit: (el) => { output.textContent = 'Name submitted: ' + el.value; }
    });
    inputsEditor.Elementals.addLabel({ row: 3, col: 2, text: 'Email:' });
    inputsEditor.Elementals.addInput({
      row: 3, col: 9,
      width: 25,
      placeholder: 'Enter email',
      onSubmit: (el) => { output.textContent = 'Email submitted: ' + el.value; }
    });
    inputsEditor.Elementals.enabled = true;
    inputsEl.addEventListener('keydown', (e) => {
      if (e.key === 'Tab' && !e.target.matches('input')) {
        e.preventDefault();
        inputsEditor.Elementals.nextElement();
      }
    });

    // Mixed demo
    const mixedEl = document.getElementById('mixed-demo');
    const mixedEditor = new Vbuf(mixedEl, {
      initialViewportSize: 8,
      showGutter: false,
      colorPrimary: "#B2B2B2",
      colorSecondary: "#212026"
    });
    VbufElementals(mixedEditor);
    mixedEditor.Model.text = '\n\n\n\n\n\n\n';

    // Form layout
    mixedEditor.Elementals.addLabel({ row: 1, col: 2, text: 'Search:' });
    const searchInput = mixedEditor.Elementals.addInput({
      row: 1, col: 10,
      width: 30,
      placeholder: 'Enter search term',
      onSubmit: (el) => { output.textContent = 'Searching for: ' + el.value; }
    });
    mixedEditor.Elementals.addButton({
      row: 1, col: 42,
      label: 'Go',
      onActivate: () => {
        const input = mixedEditor.Elementals.elements.find(e => e.type === 'input');
        output.textContent = 'Searching for: ' + (input ? input.value : '');
      }
    });

    mixedEditor.Elementals.addLabel({ row: 4, col: 2, text: 'Options:' });
    mixedEditor.Elementals.addButton({
      row: 4, col: 12,
      label: 'Settings',
      onActivate: () => { output.textContent = 'Settings opened'; }
    });
    mixedEditor.Elementals.addButton({
      row: 4, col: 26,
      label: 'Help',
      onActivate: () => { output.textContent = 'Help opened'; }
    });
    mixedEditor.Elementals.addButton({
      row: 4, col: 36,
      label: 'About',
      onActivate: () => { output.textContent = 'About dialog'; }
    });

    mixedEditor.Elementals.addButton({
      row: 6, col: 2,
      label: 'Submit Form',
      onActivate: () => {
        const input = mixedEditor.Elementals.elements.find(e => e.type === 'input');
        output.textContent = 'Form submitted with: ' + (input ? input.value : '');
      }
    });
    mixedEditor.Elementals.addButton({
      row: 6, col: 20,
      label: 'Reset',
      onActivate: () => {
        const input = mixedEditor.Elementals.elements.find(e => e.type === 'input');
        if (input) input.value = '';
        output.textContent = 'Form reset';
      }
    });

    mixedEditor.Elementals.enabled = true;
    mixedEl.addEventListener('keydown', (e) => {
      if (e.key === 'Tab' && !e.target.matches('input')) {
        e.preventDefault();
        if (e.shiftKey) {
          mixedEditor.Elementals.prevElement();
        } else {
          mixedEditor.Elementals.nextElement();
        }
      } else if (e.key === 'Enter' && !e.target.matches('input')) {
        e.preventDefault();
        mixedEditor.Elementals.activateFocused();
      }
    });

    // Focus first editor
    buttonsEl.focus();
  </script>
</body>
</html>
