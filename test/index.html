<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>buffee - Tests</title>
    <link rel="stylesheet" href="../reset.css">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="lib/vs2015.min.css">
    <style>
        body { max-width: 1200px; }

        /* Tabs */
        .tabs { display: flex; gap: 4px; border-bottom: 1px solid #ccc; margin-bottom: 1rem; }
        .tab { padding: 8px 16px; cursor: pointer; background: #f4f4f4; border: 1px solid #ccc; border-bottom: none; border-radius: 4px 4px 0 0; color: #333; }
        .tab:hover { background: #e8e8e8; color: #000; }
        .tab.active { background: white; border-bottom: 1px solid white; margin-bottom: -1px; font-weight: bold; color: #000; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        #tab-source.active { display: flex; flex-direction: column; }
        #test-stale-warning { margin-left: auto; color: #b8860b; font-size: 0.9rem; }

        /* Summary bar */
        .summary { display: flex; gap: 24px; align-items: center; padding: 12px 0; margin-bottom: 1rem; flex-wrap: wrap; }
        .summary-item { display: flex; align-items: baseline; gap: 6px; }
        .summary-number { font-size: 1.5rem; font-weight: bold; }
        .summary-label { font-size: 0.75rem; text-transform: uppercase; opacity: 0.7; }
        .summary-timing { margin-left: auto; font-size: 0.9rem; }
        .summary-timing .duration { font-weight: bold; color: #0e639c; display: inline-block; width: 130px; overflow: hidden; }
        .summary-timing .details { display: inline-block; width: 280px; overflow: hidden; }

        /* Test results */
        .test-suite { margin-bottom: 16px; border: 1px solid black; }
        .test-suite-header { padding: 8px 12px; cursor: pointer; display: flex; justify-content: space-between; font-weight: 600; }
        .test-suite-header:hover { background: #f4f4f4; }
        .test-suite-body { padding: 8px 12px; }
        .collapsed .test-suite-body { display: none; }
        .toggle-icon { transition: transform 0.2s; }
        .collapsed .toggle-icon { transform: rotate(-90deg); }

        .test-case { padding: 4px 0; display: flex; align-items: center; }
        .test-case.skipped { opacity: 0.5; }
        .test-icon { margin-right: 8px; }
        .test-icon.pass { color: #28a745; }
        .test-icon.fail { color: #dc3545; }
        .test-icon.skipped { color: #6c757d; }
        .compile-error-icon { color: #b8860b; margin-left: 4px; }
        .test-message { flex: 1; }
        .test-description { margin-top: 2px; font-size: 0.85rem; opacity: 0.7; font-style: italic; }
        .test-error { margin-top: 8px; padding: 8px; background: #fff; border: 1px solid #dc3545; font-family: monospace; font-size: 0.85rem; color: #dc3545; white-space: pre-wrap; }

        .walkthrough-btn { margin-left: 8px; font-size: 0.75rem; padding: 2px 8px; }
        .walkthrough-na { color: #999; font-size: 0.75rem; margin-left: 8px; font-style: italic; }

        /* Error banner */
        .test-error-banner { background: #fff3cd; border: 2px solid #b8860b; border-radius: 4px; padding: 12px 16px; margin-bottom: 1rem; display: flex; align-items: center; gap: 12px; }
        .test-error-banner .warning-icon { font-size: 1.25rem; color: #b8860b; }
        .test-error-banner #test-error-text { font-weight: 600; color: #856404; flex: 1; }
        .error-details-btn { background: #b8860b; color: white; border: none; padding: 6px 12px; border-radius: 3px; cursor: pointer; }
        .error-details-btn:hover { background: #9a7209; }

        /* Buttons */
        button:not(.walkthrough-btn):not(.tab):not(.walkthrough-code-tab) { background: #0e639c; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; }
        button:not(.walkthrough-btn):not(.tab):not(.walkthrough-code-tab):hover { background: #1177bb; }
        button:not(.walkthrough-btn):not(.tab):not(.walkthrough-code-tab):disabled { background: #ccc; color: #666; cursor: not-allowed; }
        .run-tests-btn { margin-left: auto; }

        /* Source tab */
        #tab-source main { display: flex; gap: 1rem; }
        .pane { width: 50%; display: flex; flex-direction: column; }
        .pane-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; min-height: 32px; }
        .pane-content { width: 100%; }
        .editor-wrapper { display: flex; height: 100%; border: 1px solid #ccc; border-radius: 4px;  }
        .line-numbers { background: #f4f4f4; padding: 1rem 0.75rem; text-align: right; font-family: monospace; font-size: 14px; line-height: 1.5; user-select: none; border-right: 1px solid #ccc; color: #666; }
        .dsl-editor-container { flex: 1; position: relative; }
        .dsl-editor-textarea { position: absolute; top: 0; left: 0; width: 100%; height: 100%; padding: 1rem; border: none; background: transparent; color: transparent; font-family: monospace; font-size: 14px; line-height: 1.5; resize: none; outline: none; white-space: pre; z-index: 2; caret-color: #333; }
        .dsl-editor-textarea::selection { background: rgba(14, 99, 156, 0.3); }
        .dsl-editor-highlight { position: absolute; top: 0; left: 0; width: 100%; height: 100%; padding: 1rem; background: white; font-family: monospace; font-size: 14px; line-height: 1.5; white-space: pre;  z-index: 1; pointer-events: none; }

        /* DSL syntax colors */
        .dsl-keyword { color: #0e639c; font-weight: 600; }
        .dsl-string { color: #a31515; }
        .dsl-number { color: #098658; }
        .dsl-quantifier { color: #811f3f; }
        .dsl-special-key { color: #0e639c; }
        .dsl-comment { color: #008000; font-style: italic; }
        .dsl-javascript { color: #333; }

        #js-output { height: 100%; border: 1px solid #ccc; background: #f8f8f8; }
        #js-output.stale { opacity: 0.5; }
        #js-output.has-errors { border: 3px solid #b8860b; }
        #js-output .hljs { background: transparent; padding: 0; }
        #error-warning { display: flex; align-items: center; gap: 0.5rem; }
        .error-warning-text { color: #b8860b; font-weight: 600; font-size: 0.9rem; }
        .status-message { display: none; font-size: 0.85rem; }
        .status-message.visible { display: inline; }
        .status-message.success { color: #28a745; }

        /* Grammar tab */
        #tab-grammar main { font-family: monospace; font-size: 14px; line-height: 1.6; white-space: pre; overflow-x: auto; }
        .g-nt { color: #098658; }  /* non-terminal */
        .g-kw { color: #0e639c; font-weight: 600; }  /* keyword */
        .g-str { color: #a31515; }  /* string */
        .g-q { color: #811f3f; }  /* quantifier */
        .g-arr { color: #28a745; }  /* arrow */
        .g-dim { opacity: 0.6; }  /* dimmed */

        /* Modal */
        .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 999; opacity: 0; pointer-events: none; transition: opacity 0.2s; }
        .modal-backdrop.active { opacity: 1; pointer-events: auto; }
        .compile-errors-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 800px; max-height: 80vh; background: white; border: 2px solid #dc3545; border-radius: 8px; z-index: 1000; opacity: 0; pointer-events: none; display: flex; flex-direction: column; }
        .compile-errors-modal.active { opacity: 1; pointer-events: auto; }
        .modal-header { padding: 1rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #dc3545; font-weight: bold; color: #dc3545; }
        .modal-close { background: #dc3545; }
        .modal-close:hover { background: #c82333; }
        .modal-body { flex: 1; overflow-y: auto; padding: 1rem; }
        .error-item { background: #f8f8f8; border-left: 3px solid #dc3545; padding: 0.75rem; margin: 0.75rem 0; }
        .error-location { color: #0e639c; font-weight: 600; margin-bottom: 0.5rem; }
        .error-code { font-family: monospace; background: #fff; padding: 0.5rem; border: 1px solid #ccc; margin: 0.5rem 0; color: #dc3545; }
        .error-message { margin-top: 0.5rem; }

        /* Hidden test editor */
        .editor-container { display: none; }

        /* Buffee editor */
        .wb { background-color: #282C34; color: #B2B2B2; position: relative; outline: none; font-family: monospace; display: flex; flex-direction: column; }
        .wb-content { display: flex; flex: 1;  }
        .no-select { user-select: none; }
        .wb-clipboard-bridge { position: fixed; left: 0; top: 1px; width: 0; height: 1px; opacity: 0; pointer-events: none; }
        .wb .wb-lines pre::before { content: "\200B"; }
        .wb .wb-lines pre { margin: 0;  }
        .wb .wb-selection { background-color: #EDAD10; position: absolute; mix-blend-mode: difference; }
        .wb .wb-cursor { background-color: #FF6B6B; mix-blend-mode: difference; }
        .wb .wb-status span { padding-right: 4px; }

        /* DSL editor specific */
        #dsl-editor { border: 1px solid #ccc; background: white; color: #333; width: 100%; }
        #dsl-editor .wb-gutter { background: #f4f4f4; color: #666; }
        #dsl-editor .wb-lines { flex: 1;  }

        /* Walkthrough panel */
        .walkthrough-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.3); z-index: 999; opacity: 0; pointer-events: none; transition: opacity 0.2s; }
        .walkthrough-backdrop.active { opacity: 1; pointer-events: auto; }
        .walkthrough-panel { position: fixed; top: 0; bottom: 0; right: 0; width: 0; background: white; border-left: 3px solid #0e639c; z-index: 1000;  transition: width 0.3s; display: flex; flex-direction: column; color: #333; }
        .walkthrough-panel.active { width: max(1000px, 60vw); }
        .walkthrough-panel.fullscreen { width: 100vw; border-left: none; }
        .walkthrough-header { background: #f4f4f4; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ccc; }
        .walkthrough-header-buttons { display: flex; gap: 8px; }
        .walkthrough-expand { background: #6c757d; }
        .walkthrough-close { background: #dc3545; }
        .walkthrough-body { display: flex; flex: 1; min-height: 0; }
        .walkthrough-left { flex: 1; background: #f8f8f8; border-right: 1px solid #ccc; display: flex; flex-direction: column; }
        .walkthrough-right { flex: 1; display: flex; flex-direction: column; }
        .walkthrough-code-tab { padding: 8px 16px; cursor: pointer; background: transparent; border: none; color: #666; font-size: 0.85rem; border-bottom: 2px solid transparent; }
        .walkthrough-code-tab:hover { color: #333; background: #eee; }
        .walkthrough-code-tab.active { color: #000; border-bottom-color: #0e639c; font-weight: bold; }
        .walkthrough-compile-warning { background: #fff3cd; border-bottom: 2px solid #b8860b; padding: 0.75rem 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .walkthrough-compile-warning .warning-icon { color: #b8860b; }
        #walkthrough-compile-warning-text { color: #856404; font-weight: 600; }
        .code-view { flex: 1; overflow: auto; padding: 16px; font-family: monospace; font-size: 13px; line-height: 1.5; background: white; white-space: pre-wrap; }
        .code-view pre { margin: 0; color: #333; }

        /* Highlight.js light theme for walkthrough */
        .code-view .hljs { color: #333; }
        .code-view .hljs-keyword { color: #0e639c; font-weight: 600; }
        .code-view .hljs-string { color: #a31515; }
        .code-view .hljs-number { color: #098658; }
        .code-view .hljs-function { color: #795e26; }
        .code-view .hljs-title { color: #795e26; }
        .code-view .hljs-params { color: #333; }
        .code-view .hljs-comment { color: #008000; font-style: italic; }
        .code-view .hljs-built_in { color: #0e639c; }
        .code-view .hljs-literal { color: #0e639c; }
        .code-view .hljs-attr { color: #e50000; }
        .code-view .hljs-property { color: #001080; }
        .code-view .hljs-punctuation { color: #333; }
        .code-line { padding: 2px 8px; line-height: 1.6; display: flex; align-items: center; }
        .code-line:nth-child(odd) { background: #f9f9f9; }
        .code-line-content { white-space: pre; flex: 1; }
        .code-line-markers { flex-shrink: 0; display: flex; gap: 4px; margin-left: 10px; }
        .code-line.step-line { cursor: pointer; border-left: 3px solid transparent; padding-left: 5px; }
        .code-line.step-line:hover { background: #f0f0f0; }
        .code-line.step-line.current { background: #cce5ff; border-left-color: #0e639c; font-weight: bold; }
        .code-line.step-line.completed { background: #d4edda; border-left-color: #28a745; }
        .code-line.error-line { background: #f8d7da; border-left: 3px solid #dc3545; padding-left: 5px; }
        .code-line.success-line { background: #d4edda; border-left: 3px solid #28a745; padding-left: 5px; }
        .error-marker, .success-marker, .step-marker { font-weight: bold; }
        .error-marker { color: #dc3545; }
        .success-marker { color: #28a745; }
        .step-marker { width: 20px; height: 20px; line-height: 20px; text-align: center; font-size: 11px; color: white; background: #0e639c; border-radius: 50%; }
        .editor-view-container { flex: 1; padding: 16px; overflow: auto; background: #f8f8f8; }
        .step-controls-panel { background: #f4f4f4; padding: 12px 16px; border-top: 1px solid #ccc; display: flex; gap: 8px; align-items: center; }
        .step-btn { background: #0e639c; padding: 8px 16px; font-size: 13px; }
        .step-btn:disabled { background: #ccc; color: #666; opacity: 0.7; }
        .step-info { flex: 1; font-size: 13px; color: #333; }

        @media (max-width: 1300px) { .walkthrough-panel.active { width: calc(100vw - 100px); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25%, 75% { transform: translateX(-4px); } 50% { transform: translateX(4px); } }
        .shake { animation: shake 0.4s; }
    </style>
</head>
<body>
    <nav id="nav"></nav>
    <script>
        fetch('../navigation.html')
            .then(r => r.text())
            .then(html => document.getElementById('nav').innerHTML = html);
    </script>
    <p><a href="../index.html">home</a> / Tests</p>
    <h1>Unit Tests</h1>
    <h3>This test setup was AI generated with adult supervision. </h3>

    <div class="tabs">
        <button class="tab active" data-tab="tests">Tests</button>
        <button class="tab" data-tab="extensions">Extensions</button>
        <button class="tab" data-tab="source">Source</button>
        <button class="tab" data-tab="grammar">Grammar</button>
        <button class="tab" data-tab="diagnostics">AI Diagnostics</button>
        <span id="test-stale-warning" class="status-message warning" style="display: none;"><span class="warning-icon">⚠</span> source spec changed, recompile</span>
    </div>
    <div id="tab-tests" class="tab-content active">
        <main>
            <div id="test-error-warning" class="test-error-banner" style="display: none;">
                <span class="warning-icon">⚠</span>
                <span id="test-error-text">Compilation errors. Some tests may have lines omitted</span>
                <button id="test-error-details-btn" class="error-details-btn">Details</button>
            </div>
            <div class="summary">
                <div class="summary-item">
                    <div class="summary-number" id="total-tests">0</div>
                    <div class="summary-label">Total</div>
                </div>
                <div class="summary-item">
                    <div class="summary-number" style="color: #28a745" id="passed-tests">0</div>
                    <div class="summary-label">Passed</div>
                </div>
                <div class="summary-item">
                    <div class="summary-number" style="color: #dc3545" id="failed-tests">0</div>
                    <div class="summary-label">Failed</div>
                </div>
                <div class="summary-item" id="compile-errors-summary">
                    <div class="summary-number" style="color: #b8860b" id="compile-error-tests">0</div>
                    <div class="summary-label">with compile errors</div>
                </div>
                <div class="summary-item">
                    <div class="summary-number" style="color: #6c757d" id="skipped-tests">0</div>
                    <div class="summary-label">Skipped</div>
                </div>
                <div id="test-timing" class="summary-timing"></div>
            </div>
            <div id="test-results"></div>

            <!-- Hidden editor container for tests -->
            <div class="editor-container">
                <div class="wb no-select">
                    <textarea class="wb-clipboard-bridge" aria-hidden="true"></textarea>
                    <div class="no-select wb-elements">
                        <div class="wb-gutter"></div>
                        <div class="wb-lines" tabindex="0"><blockquote class="wb-layer-text"></blockquote><div class="wb-layer-elements"></div><div class="wb-cursor"></div></div>
                    </div>
                    <div class="wb-status" style="display: flex; justify-content: space-between;">
                        <div class="wb-status-left" style="display: flex;">
                            <span class="wb-linecount"></span>
                        </div>
                        <div class="wb-status-right" style="display: flex;">
                            Ln <span class="wb-head-row"></span>, Col <span class="wb-head-col"></span>|

                            <span class="buffee-spaces"></span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <div id="tab-extensions" class="tab-content">
        <main>
            <div class="summary">
                <div class="summary-item">
                    <div class="summary-number" id="ext-total-tests">0</div>
                    <div class="summary-label">Total</div>
                </div>
                <div class="summary-item">
                    <div class="summary-number" style="color: #28a745" id="ext-passed-tests">0</div>
                    <div class="summary-label">Passed</div>
                </div>
                <div class="summary-item">
                    <div class="summary-number" style="color: #dc3545" id="ext-failed-tests">0</div>
                    <div class="summary-label">Failed</div>
                </div>
                <div id="ext-test-timing" class="summary-timing"></div>
            </div>
            <div id="ext-test-results"></div>
        </main>
    </div>
    <div id="tab-source" class="tab-content">
        <main>
            <div class="pane">
                <div class="pane-header">
                    <span>Source DSL</span>
                    <div>
                        <span id="status-uptodate" class="status-message success"><span class="success-icon">✓</span>Generated JavaScript is up to date</span>
                        <button id="generate-btn" class="walkthrough-btn">Compile and Run Tests</button>
                    </div>
                </div>
                <div class="pane-content">
                    <div class="wb no-select" id="dsl-editor">
                        <textarea class="wb-clipboard-bridge" aria-hidden="true"></textarea>
                        <div class="no-select wb-elements">
                            <div class="wb-gutter"></div>
                            <div class="wb-lines" tabindex="0"><blockquote class="wb-layer-text"></blockquote><div class="wb-layer-elements"></div><div class="wb-cursor"></div></div>
                        </div>
                        <div class="wb-status" style="display: none;">
                            <div><span class="wb-linecount"></span></div>
                            <div>Ln <span class="wb-head-row"></span>, Col <span class="wb-head-col"></span>|<span class="buffee-spaces"></span></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pane">
                <div class="pane-header">
                    <span>Generated JavaScript</span>
                    <div id="error-warning" style="display: none;">
                        <span class="error-warning-text"></span>
                        <button id="error-details-btn" class="error-details-btn">Details</button>
                    </div>
                </div>
                <div class="pane-content">
                    <div class="wb no-select" id="js-output">
                        <textarea class="wb-clipboard-bridge" aria-hidden="true"></textarea>
                        <div class="no-select wb-elements">
                            <div class="wb-gutter"></div>
                            <div class="wb-lines" tabindex="0"><blockquote class="wb-layer-text"></blockquote><div class="wb-layer-elements"></div><div class="wb-cursor"></div></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <div id="tab-grammar" class="tab-content">
        <main>A domain specific language for testing the text editor state

<span class="g-nt">&lt;command&gt;</span>          ::= <span class="g-nt">&lt;press-command&gt;</span> | <span class="g-nt">&lt;type&gt;</span> | <span class="g-nt">&lt;expect-cursor&gt;</span> | <span class="g-nt">&lt;expect-selection&gt;</span>
<span class="g-nt">&lt;type&gt;</span>             ::= <span class="g-kw">TYPE</span> <span class="g-str">"text"</span>
<span class="g-nt">&lt;press-command&gt;</span>    ::= <span class="g-nt">&lt;press&gt;</span> <span class="g-q">[quantification]</span> [<span class="g-kw">with</span> <span class="g-str">&lt;modifiers&gt;</span>]
                     | <span class="g-nt">&lt;press&gt;</span> [<span class="g-kw">with</span> <span class="g-str">&lt;modifiers&gt;</span>] <span class="g-q">[quantification]</span>
<span class="g-nt">&lt;press&gt;</span>            ::= <span class="g-kw">PRESS</span> (<span class="g-nt">&lt;char&gt;</span> | <span class="g-nt">&lt;special-key&gt;</span>) | <span class="g-nt">&lt;special-key&gt;</span>
<span class="g-nt">&lt;expect-cursor&gt;</span>    ::= <span class="g-kw">EXPECT</span> <span class="g-q">cursor</span> <span class="g-kw">at</span> <span class="g-q">&lt;row&gt;</span><span class="g-dim">,</span><span class="g-q">&lt;col&gt;</span>
<span class="g-nt">&lt;expect-selection&gt;</span> ::= <span class="g-kw">EXPECT</span> <span class="g-q">selection</span> <span class="g-kw">at</span> <span class="g-q">&lt;startRow&gt;</span><span class="g-dim">,</span><span class="g-q">&lt;startCol&gt;</span><span class="g-dim">-</span><span class="g-q">&lt;endRow&gt;</span><span class="g-dim">,</span><span class="g-q">&lt;endCol&gt;</span>
<span class="g-nt">&lt;char&gt;</span>             ::= <span class="g-str">a</span> | <span class="g-str">" "</span> | <span class="g-str">';'</span> | ...
<span class="g-nt">&lt;special-key&gt;</span>      ::= <span class="g-str">backspace</span> | <span class="g-str">enter</span> | <span class="g-str">left</span> | <span class="g-str">right</span> | <span class="g-str">up</span> | <span class="g-str">down</span>
<span class="g-nt">&lt;quantification&gt;</span>   ::= <span class="g-q">once</span> | <span class="g-q">N time(s)</span> <span class="g-dim">(default: once)</span>
<span class="g-nt">&lt;modifiers&gt;</span>        ::= <span class="g-str">shift</span> | <span class="g-str">meta</span> | <span class="g-str">meta, shift</span>

Examples in Normalized Form        <span class="g-arr">→</span>  Transpilation
<span class="g-kw">TYPE</span> <span class="g-str">"Hello"</span>                       <span class="g-arr">→</span>  fixture.<span class="g-kw">type</span>(<span class="g-str">'Hello'</span>);
<span class="g-kw">PRESS</span> <span class="g-str">a</span> <span class="g-q">once</span>                       <span class="g-arr">→</span>  fixture.<span class="g-kw">press</span>(<span class="g-str">'a'</span>).<span class="g-q">once()</span>;
<span class="g-kw">PRESS</span> <span class="g-str">";"</span>                          <span class="g-arr">→</span>  fixture.<span class="g-kw">press</span>(<span class="g-str">';'</span>).<span class="g-q">once()</span>;
<span class="g-kw">PRESS</span> <span class="g-str">' '</span>                          <span class="g-arr">→</span>  fixture.<span class="g-kw">press</span>(<span class="g-str">' '</span>).<span class="g-q">times(1)</span>;
<span class="g-str">enter</span> <span class="g-q">1 time</span>                       <span class="g-arr">→</span>  fixture.<span class="g-kw">press</span>(<span class="g-str">Key.Enter</span>).<span class="g-q">once()</span>;
<span class="g-str">backspace</span>                          <span class="g-arr">→</span>  fixture.<span class="g-kw">press</span>(<span class="g-str">Key.Backspace</span>).<span class="g-q">times(3)</span>;
<span class="g-str">left</span> <span class="g-q">3 times</span> <span class="g-kw">with</span> <span class="g-str">meta</span>             <span class="g-arr">→</span>  fixture.<span class="g-kw">press</span>(<span class="g-str">Key.ArrowLeft</span>).<span class="g-str">withMetaKey()</span>.<span class="g-q">once()</span>;
<span class="g-str">right</span> <span class="g-kw">with</span> <span class="g-str">meta</span>, <span class="g-str">shift</span>             <span class="g-arr">→</span>  fixture.<span class="g-kw">press</span>(<span class="g-str">Key.ArrowRight</span>).<span class="g-str">withMetaKey()</span>.<span class="g-str">withShiftKey()</span>.<span class="g-q">once()</span>;
<span class="g-kw">EXPECT</span> <span class="g-q">cursor</span> <span class="g-kw">at</span> <span class="g-q">0,5</span>               <span class="g-arr">→</span>  <span class="g-kw">expect</span>(fixture).<span class="g-q">toHaveCursorAt</span>(<span class="g-q">0</span>, <span class="g-q">5</span>);
<span class="g-kw">EXPECT</span> <span class="g-q">selection</span> <span class="g-kw">at</span> <span class="g-q">1,2-4,5</span>        <span class="g-arr">→</span>  <span class="g-kw">expect</span>(fixture).<span class="g-q">toHaveSelectionAt</span>(<span class="g-q">1</span>, <span class="g-q">2</span>, <span class="g-q">4</span>, <span class="g-q">5</span>);

<span class="g-dim">JavaScript pass-through for lines ending with ";", starting with "//" and empty lines:</span>
expect(3+5).toBe(8);               <span class="g-arr">→</span>  expect(3+5).toBe(8);
// This is a comment               <span class="g-arr">→</span>  // This is a comment
(empty line)                       <span class="g-arr">→</span>  (empty line)</main>
    </div>
    <div id="tab-diagnostics" class="tab-content">
        <main>
            <p style="margin-bottom: 1rem;">Copy all test failures to paste into Claude for debugging:</p>
            <div style="margin-bottom: 1rem;">
                <label><input type="checkbox" id="fail-fast-checkbox" onchange="toggleFailFast()"> Fail-fast mode (stop on first failure)</label>
            </div>
            <button id="copy-diagnostics-btn" onclick="copyDiagnosticsText()">Copy to Clipboard</button>
            <pre id="diagnostics-output" style="margin-top: 1rem; padding: 1rem; background: #f4f4f4; border: 1px solid #ccc; white-space: pre-wrap; max-height: 600px; overflow: auto;">Loading...</pre>
        </main>
    </div>

    <!-- Compile Errors Modal -->
    <div id="compile-errors-backdrop" class="modal-backdrop"></div>
    <div id="compile-errors-modal" class="compile-errors-modal">
        <div class="modal-header">
            <span>Compile Errors</span>
            <button class="modal-close" onclick="closeCompileErrorsModal()">Close</button>
        </div>
        <div class="modal-body" id="compile-errors-content"></div>
    </div>

    <!-- Walkthrough backdrop -->
    <div id="walkthrough-backdrop" class="walkthrough-backdrop"></div>

    <!-- Walkthrough panel -->
    <div id="walkthrough-panel" class="walkthrough-panel">
        <div class="walkthrough-header">
            <div>
                <span>Test Case: </span><strong id="walkthrough-test-name"></strong>
                <span style="margin-left: 12px; opacity: 0.7; font-size: 12px;" id="walkthrough-test-desc"></span>
            </div>
            <div class="walkthrough-header-buttons">
                <button class="walkthrough-expand" onclick="walkthrough.toggleFullscreen()" id="walkthrough-expand-btn">⛶ Expand</button>
                <button class="walkthrough-close" onclick="walkthrough.close()">Close (<code style="background: none; color: inherit; font-size: inherit;">Esc</code>)</button>
            </div>
        </div>
        <div class="walkthrough-body">
            <div class="walkthrough-left">
                <div id="walkthrough-compile-warning" class="walkthrough-compile-warning" style="display: none;">
                    <span class="warning-icon">⚠</span>
                    <span id="walkthrough-compile-warning-text">Compiled with errors</span>
                </div>
                <div style="background: #f4f4f4; border-bottom: 1px solid #ccc; display: flex; align-items: center;">
                    <button class="walkthrough-code-tab active" data-code-tab="js">Generated JavaScript</button>
                    <button class="walkthrough-code-tab" data-code-tab="dsl">Source DSL</button>
                    <button id="copy-dsl-btn" style="margin-left: auto; margin-right: 12px; display: none; padding: 4px 12px; font-size: 12px;" onclick="copyDSLSource()">Copy to clipboard</button>
                </div>
                <div class="code-view active" id="walkthrough-code-js"></div>
                <div class="code-view" id="walkthrough-code-dsl" style="display: none;"></div>
            </div>
            <div class="walkthrough-right">
                <div style="padding: 12px 16px; background: #f4f4f4; border-bottom: 1px solid #ccc;">
                    <strong>System-under-test</strong>
                    <div style="margin-top: 4px; font-size: 11px; opacity: 0.6; font-style: italic;">note: you can only observe but not interact with this editor</div>
                </div>
                <div class="editor-view-container">
                    <div class="wb" id="walkthrough-editor">
                        <textarea class="wb-clipboard-bridge" aria-hidden="true"></textarea>
                        <div class="no-select wb-elements">
                            <div class="wb-gutter"></div>
                            <div class="wb-lines" tabindex="0"><blockquote class="wb-layer-text"></blockquote><div class="wb-layer-elements"></div><div class="wb-cursor"></div></div>
                        </div>
                        <div class="wb-status" style="display: none;">
                            <div class="wb-status-left"><span class="wb-linecount"></span></div>
                            <div class="wb-status-right">Ln <span class="wb-head-row"></span>, Col <span class="wb-head-col"></span><span class="wb-status-divider">|</span><span class="buffee-spaces"></span></div>
                        </div>
                    </div>
                </div>
                <div class="step-controls-panel">
                    <button class="step-btn" id="step-prev" onclick="walkthrough.stepPrev()">← Previous</button>
                    <div class="step-info" id="step-info">Step 0 / 0</div>
                    <button class="step-btn" id="step-next" onclick="walkthrough.stepNext()">Next →</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Syntax highlighting -->
    <script src="lib/highlight.min.js"></script>

    <!-- Test dependencies -->
    <script src="../buffee.js"></script>
    <script src="../extensions/callbacks.js"></script>
    <script src="../extensions/syntax.js"></script>
    <script src="../extensions/elementals.js"></script>
    <script src="../extensions/highlights.js"></script>
    <script src="../extensions/tui-legacy.js"></script>
    <script src="../extensions/ultrahighcapacity.js"></script>
    <script src="lib/test-walkthrough.js"></script>
    <script src="lib/test-runner.js"></script>
    <script src="lib/test-expect.js"></script>
    <!-- Tests are loaded from generated JavaScript instead of test.spec.js -->

    <!-- DSL generator dependencies -->
    <script src="./dsl/dsl-transpiler.js"></script>
    <script src="./dsl/dsl-generator.js"></script>

    <script src="lib/test-extensions.js"></script>
    <script src="lib/test-ui.js"></script>
</body>
</html>
